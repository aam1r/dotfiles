# ================ Git and Vim functions ================
# Open all files for the current commit in vim
function opencommit {
    vim -p $(git diff HEAD^ --name-only)
}

# ================ Bash functions ================
# Wait for pid to finish executing
# Usage: waitforpid 311
function waitforpid {
    while ps -p $1 1>/dev/null 2> /dev/null; do
        sleep 1;
    done
}

# Wait for process to finish executing
# Usage: waitforprocess myscript.py
function waitforprocess {
    while ps -p $(pgrep $1) 1>/dev/null 2> /dev/null; do
        sleep 1;
    done
}

# Returns the number of seconds a process has been alive by looking at /proc
function pid_seconds {
    echo $(($(date +%s) - $(stat -c '%Y' /proc/$1)))
}

# Find a useable SSH agent when running an agent session
ssh-reagent () {
    for agent in /tmp/ssh-*/agent.*; do
        echo "Trying $agent"
        export SSH_AUTH_SOCK=$agent
        if timeout -t 2 ssh-add -l 2>&1 > /dev/null; then
            echo Found working SSH Agent:
            ssh-add -l
            return
        fi
    done
    echo Cannot find ssh agent - maybe you should reconnect and forward it?
}

# Serve files under current dir at http://localhost:8000
function webserver {
    python -m SimpleHTTPServer
}
